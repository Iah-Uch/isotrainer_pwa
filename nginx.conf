server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;

  # Proper MIME type mapping
  include /etc/nginx/mime.types;
  default_type application/octet-stream;
  autoindex off;

  # Do not serve hidden files (.git, .env, etc.)
  location ~ /\. { deny all; }

  # Whitelist only relevant public files and folders
  location = / { try_files /index.html =404; }
  location = /index.html { try_files /index.html =404; }
  location = /app.html { try_files /app.html =404; }
  location = /styles.css { try_files /styles.css =404; }

  # PWA: service worker and manifest (no aggressive cache)
  location = /sw.js { add_header Cache-Control "no-cache"; try_files /sw.js =404; }
  location = /manifest.webmanifest {
    add_header Cache-Control "no-cache";
    default_type application/manifest+json;
    try_files /manifest.webmanifest =404;
  }

  # Favicon: point .ico requests to existing 192px icon
  location = /favicon.ico {
    expires 7d;
    try_files /icons/logo_cardiomax.svg =404;
  }

  # Static folders (serve files inside only)
  location /js/ { try_files $uri =404; }
  location /icons/ { try_files $uri =404; }
  location /assets/ { try_files $uri =404; }

  # Cache headers for static assets
  location ~* \.(?:js|css)$ { add_header Cache-Control "public, max-age=31536000, immutable"; }
  location ~* \.(?:png|jpg|jpeg|gif|svg|webp|ico)$ { add_header Cache-Control "public, max-age=31536000, immutable"; }
}
