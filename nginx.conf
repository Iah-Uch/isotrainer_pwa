server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;

  # Proper MIME type mapping
  include /etc/nginx/mime.types;
  default_type application/octet-stream;
  autoindex off;

  # Global no-cache for all responses
  etag off;
  add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0" always;
  add_header Pragma "no-cache" always;          # for legacy proxies
  add_header Expires "0" always;

  # Do not serve hidden files (.git, .env, etc.)
  location ~ /\. { deny all; }

  # Whitelist only relevant public files and folders
  location = / { try_files /index.html =404; }
  location = /index.html { try_files /index.html =404; }
  location = /app.html { try_files /app.html =404; }
  location = /plan-generator.html { try_files /plan-generator.html =404; }

  # PWA: service worker and manifest
  location = /sw.js { try_files /sw.js =404; }
  location = /manifest.webmanifest {
    default_type application/manifest+json;
    try_files /manifest.webmanifest =404;
  }

  # Favicon: point .ico requests to existing 192px icon
  location = /favicon.ico {
    expires off;
    try_files /icons/logo_isotrainer.png =404;
  }

  # Static folders (serve files inside only)
  location /icons/ { try_files $uri =404; }
  location /assets/ { try_files $uri =404; }

  # No static asset caching (handled globally by headers above)
}
